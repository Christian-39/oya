{% load humanize %}
<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Dashboard</title>

	<!-- Fonts & Icons -->
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<style>
		:root {
			--primary: #0a7c5b;
			--bg: #f5f7f6;
			--card: #ffffff;
			--text: #1f2933;
			--muted: #6b7280;
			--shadow: 0 10px 25px rgba(0, 0, 0, .08);
			--radius: 16px;
		}

		body.dark {
			--bg: #0b1220;
			--card: #0f172a;
			--text: #e5e7eb;
			--muted: #94a3b8;
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			font-family: 'Poppins', sans-serif;
			background: var(--bg);
			color: var(--text);
			min-height: 100vh;
			display: flex;
		}

		/* Sidebar */
		.sidebar {
			width: 220px;
			background: linear-gradient(180deg, #0a7c5b, #0fb38a);
			color: #eafff9;
			padding: 20px 18px;
			position: fixed;
			inset: 0 auto 0 0;
			z-index: 1000;
			box-shadow: 6px 0 30px rgba(0, 0, 0, .25);
			transition: transform .3s ease;
		}

		.sidebar .brand {
			display: flex;
			justify-content: center;
			margin-bottom: 12px;
		}

		.sidebar .avatar {
			width: 56px;
			height: 56px;
			border-radius: 50%;
			background: #fff;
			color: #0a7c5b;
			display: grid;
			place-items: center;
			font-size: 22px;
			font-weight: 600;
			box-shadow: 0 8px 20px rgba(0, 0, 0, .2);
		}

		.sidebar strong {
			display: block;
			text-align: center;
			margin-top: 8px;
			font-weight: 600;
			font-size: 14px;
		}


		.sidebar .sub {
			text-align: center;
			font-size: 12px;
			opacity: .85;
			margin-bottom: 18px;
		}

		.sidebar.hide {
			transform: translateX(-100%);
		}

		/* Menu */
		.menu {
			margin-top: 12px;
		}

		.menu a {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 11px 14px;
			border-radius: 12px;
			color: #eafff9;
			text-decoration: none;
			font-size: 14px;
			margin-bottom: 6px;
		}

		.menu a i {
			width: 18px;
			text-align: center;
		}

		.menu a:hover {
			background: rgba(255, 255, 255, .18);
			transform: translateX(6px);
		}


		.brand {
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 20px;
		}

		.brand img {
			width: 42px;
			height: 42px;
			object-fit: contain;
			border-radius: 50%;
			background: #fff;
			padding: 4px;
		}

		.brand span {
			font-weight: 600;
			font-size: 16px;
			line-height: 1.2;
		}

		.menu a {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 12px;
			border-radius: 10px;
			text-decoration: none;
			color: #eafff9;
			margin-bottom: 6px;
		}

		.menu a:hover {
			background: rgba(255, 255, 255, .15);
		}

		/* Main */
		.main {
			margin-left: 250px;
			width: 100%;
			padding: 16px 20px 30px;
		}

		/* Topbar */
		.topbar {
			position: sticky;
			top: 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 14px 18px;
			margin-bottom: 22px;
			background: rgba(255, 255, 255, .75);
			backdrop-filter: blur(10px);
			border-radius: 16px;
			box-shadow: 0 12px 30px rgba(0, 0, 0, .08);
			z-index: 50;
		}


		.left-top {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.hamburger {
			display: none;
			border: none;
			background: var(--card);
			box-shadow: var(--shadow);
			border-radius: 10px;
			padding: 8px 10px;
			cursor: pointer;
		}

		.topbar .brand {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.topbar .brand img {
			width: 38px;
			height: 38px;
			border-radius: 50%;
			background: #fff;
			padding: 4px;
		}

		.actions {
			display: flex;
			align-items: center;
			gap: 10px;
			position: relative;
			z-index: 60;
		}

		.icon-btn {
			border: none;
			background: var(--card);
			box-shadow: var(--shadow);
			border-radius: 10px;
			padding: 8px 10px;
			cursor: pointer;
			position: relative;
		}

		.badge {
			position: absolute;
			top: -17px;
			right: -9px;
			background: #ef4444;
			color: #fff;
			font-size: 10px;
			border-radius: 50%;
			padding: 0px 5px;
		}

		.dropdown {
			position: absolute;
			right: 0;
			top: 110%;
			background: var(--card);
			box-shadow: var(--shadow);
			border-radius: 12px;
			width: 220px;
			padding: 10px;
			display: none;
			z-index: 9999;
		}

		.dropdown.show {
			display: block;
		}

		.dropdown a,
		.dropdown p {
			display: block;
			padding: 8px;
			margin: 0;
			text-decoration: none;
			color: var(--text);
			border-radius: 8px;
			font-size: 14px;
		}

		.dropdown a:hover {
			background: rgba(0, 0, 0, .05);
		}


		.profile {
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
		}


		.avatar {
			width: 32px;
			height: 32px;
			border-radius: 50%;
			background: linear-gradient(135deg, #0a7c5b, #0fb38a);
			color: #fff;
			display: grid;
			place-items: center;
			font-weight: 600;
		}

		/* Cards */
		.stats {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
			gap: 14px;
			margin: 16px 0 22px;
		}

		.stat-card {
			background: var(--card);
			border-radius: var(--radius);
			box-shadow: var(--shadow);
			padding: 16px;
			display: flex;
			gap: 12px;
			align-items: center;
		}

		.stat-card i {
			color: var(--primary);
			background: rgba(10, 124, 91, .1);
			padding: 10px;
			border-radius: 10px;
		}

		.grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
			gap: 14px;
		}

		.tile {
			background: var(--card);
			border-radius: var(--radius);
			box-shadow: var(--shadow);
			padding: 16px;
			text-align: center;
			transition: transform .2s, box-shadow .2s;
		}

		.tile:hover {
			transform: translateY(-4px);
			box-shadow: 0 14px 30px rgba(0, 0, 0, .12);
		}

		.tile i {
			color: var(--primary);
			margin-bottom: 6px;
		}

		.tile a {
			text-decoration: none;
			color: var(--text);
			font-weight: 500;
			font-size: 14px;
			display: block;
		}

		.section {
			background: var(--card);
			border-radius: var(--radius);
			box-shadow: var(--shadow);
			padding: 16px;
			margin-top: 18px;
		}

		.projects {
			background: linear-gradient(135deg, #0a7c5b, #0fb38a);
			color: #fff;
			border-radius: var(--radius);
			padding: 18px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 10px;
		}

		.btn {
			background: #fff;
			color: #0a7c5b;
			border-radius: 10px;
			padding: 10px 14px;
			text-decoration: none;
			font-weight: 600;
			border: none;
			cursor: pointer;
		}

		.close-btn {
			display: none;
			position: absolute;
			top: 14px;
			right: 14px;
			border: none;
			background: rgba(255, 255, 255, 0.15);
			color: #fff;
			border-radius: 8px;
			padding: 6px 10px;
			cursor: pointer;
		}

		@media (max-width: 900px) {
			.main {
				margin-left: 0;
			}

			.sidebar {
				transform: translateX(-100%);
			}

			.sidebar.show {
				transform: translateX(0);
			}

			.hamburger {
				display: inline-flex;
			}

			.close-btn {
				display: inline-flex;
			}
		}

		.welcome-mini strong {
			font-size: 15px;
		}

		.welcome-mini .sub {
			font-size: 12px;
			color: var(--muted);
		}

		.stats a .stat-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 14px 30px rgba(0, 0, 0, .12);
			transition: .2s ease;
		}
		@media (max-width: 640px) {
  body {
    padding: 0;
  }

  .container {
    max-width: 100%;
    border-radius: 0;
    padding: 14px;
  }
}

	</style>
</head>

<body>

	<!-- Sidebar -->
	<aside class="sidebar" id="sidebar">
		<div class="brand">
			<a href="{% url 'dashboard' %}" style="text-decoration: none;"><div class="avatar">{{ member.full_name|slice:":1" }}</div></a>
		</div>
		<strong>welcome, {{ member.full_name }}</strong>
		<div class="sub">
			{% if member.executive_position %}
			<p>Post: {{ member.executive_position }}</p>
			{% endif %}
		</div>

		<button class="close-btn" onclick="toggleSidebar()">
			<i class="fa fa-times"></i>
		</button>

		<nav class="menu">
			<a href="{% url 'dashboard' %}"><i class="fa fa-home"></i> Home</a>
			<a href="{% url 'contributions_list' %}"><i class="fa fa-wallet"></i> Contributions</a>
			<a href="{% url 'donation_list' %}"><i class="fa fa-plus"></i> Donations</a>
			<a href="{% url 'executives_list' %}"><i class="fa fa-users"></i> Executives</a>
			<a href="{% url 'taskforce_list' %}"><i class="fa fa-user-shield"></i> Task Force</a>
			<a href="{% url 'motorcycles_list' %}"><i class="fa fa-motorcycle"></i> Motorcycles</a>
			<a href="{% url 'cases_list' %}"><i class="fa fa-folder-open"></i> Community Cases</a>
			<a href="{% url 'projects_list' %}"><i class="fa fa-diagram-project"></i> Projects</a>
			{% if request.session.member_role == 'admin' %}
			<a href="{% url 'admin_dashboard' %}"><i class="fa fa-user-cog"></i> Admin Panel</a>
			{% endif %}
		</nav>
	</aside>

	<!-- Main -->
	<main class="main">
		<!-- Topbar -->
		<div class="topbar">
			<div class="left-top">
				<button class="hamburger" onclick="toggleSidebar()">
					<i class="fa fa-bars"></i>
				</button>

				<div class="brand">
					<img src="{% static 'accounts/images/oya logo.jpeg' %}" alt="OYA Logo">
					<span>
						OYA<br>
						<small>Peace & Progress</small>
					</span>
				</div>
			</div>

			<div class="actions">

				<!-- Notifications / Profile Trigger -->
				<div class="profile" onclick="toggleProfile()">
					<span class="badge">
						{{ announcements_count|add:minutes_count }}
					</span>
					<i class="fa fa-cog"></i>
				</div>

				<!-- Dropdown -->
				<div class="dropdown" id="profileDrop">
					<p>
						<i class="fa fa-user-circle"></i>
						<strong>{{ member.full_name }}</strong>
					</p>

					<button class="icon-btn" onclick="toggleDark()">
						<i class="fa fa-moon"></i>
						Dark Mode
					</button>

					<a href="{% url 'member_profile' member.id %}">
						<i class="fa fa-id-badge"></i>
						My Profile
					</a>

					<a href="{% url 'announcements_list' %}">
						<i class="fa fa-bullhorn"></i>
						Announcements ({{ announcements_count }})
					</a>

					<a href="{% url 'minutes_list' %}">
						<i class="fa fa-file-lines"></i>
						Minutes ({{ minutes_count }})
					</a>

					<a href="#" onclick="window.print()">
						<i class="fa fa-print"></i>
						Print Report
					</a>

					<a href="{% url 'logout' %}">
						<i class="fa fa-right-from-bracket"></i>
						Logout
					</a>
				</div>

			</div>
		</div>


		<!-- Stats -->
		<!-- Stats -->
		<section class="stats">
			<div class="stat-card">
				<i class="fa fa-users"></i>
				<div>
					<small>Total Members</small>
					<div><strong>{{ total_members|default:"0" }}</strong></div>
				</div>
			</div>

			<!-- Total Income -->
			<a href="{% url 'income_list' %}" style="text-decoration:none; color:inherit;">
				<div class="stat-card">
					<i class="fa fa-wallet"></i>
					<div>
						<small>Total Income</small>
						<div>
							<strong>₦{{ total_money|intcomma|default:"0" }}</strong>
						</div>
					</div>
				</div>
			</a>

			<!-- Total Income -->
			<a href="{% url 'contributions_list' %}" style="text-decoration:none; color:inherit;">
				<div class="stat-card">
					<i class="fa fa-wallet"></i>
					<div>
						<small>Total yearly dues</small>
						<div>
							<strong>₦{{ total_contributions|intcomma|default:"0" }}</strong>
						</div>
					</div>
				</div>
			</a>

			<!-- Total Income -->
			<a href="{% url 'donation_list' %}" style="text-decoration:none; color:inherit;">
				<div class="stat-card">
					<i class="fa fa-wallet"></i>
					<div>
						<small>Total Donations</small>
						<div>
							<strong>₦{{ total_income|intcomma|default:"0" }}</strong>
						</div>
					</div>
				</div>
			</a>

			<!-- Total Expenses -->
			<a href="{% url 'expenses_list' %}" style="text-decoration:none; color:inherit;">
				<div class="stat-card">
					<i class="fa fa-money-bill-wave"></i>
					<div>
						<small>Total Expenses</small>
						<div>
							<strong>₦{{ total_expenses|intcomma|default:"0" }}</strong>
						</div>
					</div>
				</div>
			</a>

			<!-- Net Balance -->
			<div class="stat-card">
				<i class="fa fa-scale-balanced"></i>
				<div>
					<small>Net Balance</small>
					<div>
						<strong>
							₦{{ net_balance|intcomma|default:"0" }}
						</strong>
					</div>
				</div>
			</div>

			<div class="stat-card">
				<i class="fa fa-motorcycle"></i>
				<div>
					<small>Motorcycles</small>
					<div><strong>{{ total_motorcycles|default:"0" }}</strong></div>
				</div>
			</div>

			<div class="stat-card">
				<i class="fa fa-folder-open"></i>
				<div>
					<small>Community Cases</small>
					<div><strong>{{ total_cases|default:"0" }}</strong></div>
				</div>
			</div>
		</section>


		<!-- Quick Links -->
		<section class="grid">
			<div class="tile"><a href="{% url 'my_contributions' %}"><i class="fa fa-wallet"></i></a><a
					href="{% url 'my_contributions' %}">My Contributions</a></div>
			{% if member.role == 'admin' %}
			<div class="tile"><a href="{% url 'contributions_list' %}"><i class="fa fa-cog"></i></a><a
					href="{% url 'contributions_list' %}">Manage dues</a></div>
			{% endif %}
			<div class="tile"><a href="{% url 'executives_list' %}"><i class="fa fa-users"></i></a><a
					href="{% url 'executives_list' %}">Executives</a></div>
			<div class="tile"><a href="{% url 'taskforce_list' %}"><i class="fa fa-user-shield"></i></a><a
					href="{% url 'taskforce_list' %}">Task Force</a></div>
			<div class="tile"><a href="{% url 'motorcycles_list' %}"><i class="fa fa-motorcycle"></i></a><a
					href="{% url 'motorcycles_list' %}">Motorcycles</a></div>
			<div class="tile"><a href="{% url 'members_list' %}"><i class="fa fa-folder-open"></i></a><a
					href="{% url 'members_list' %}">Members lists</a></div>
		</section>

		<!-- Chart -->
		<section class="section">
			<h3>Monthly Contributions</h3>
			<canvas id="contribChart" height="120"></canvas>
		</section>

		<!-- Projects -->
		<section class="projects">
			<div>
				<h3>Projects</h3>
				<p>See ongoing, completed & future projects</p>
			</div>
			<a href="{% url 'projects_list' %}" class="btn">View Projects</a>
		</section>
	</main>
	<script src="{% static 'accounts/js/scripts.js' %}"></script>


</body>

</html>